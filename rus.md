# Gulp, Grunt, Whatever

[Gulp][01] — это недавно появившаяся система сборки, которая внушает большие
надежды. Он дает возможность всего за 10 минут написать [действительно лаконичный код][02].
Часто этого достаточно, чтобы противопоставить его [более многословному][03] Grunt.

Вы ведь помните Grunt? Я [достаточно много писал о нем][04] в прошлом, и 
[даже написал книгу][05], в которой я предложил использовать его как инстромент
для сборки. Grunt потрясающ, и вы должны как-нибудь обязательно его попробовать.

[Некоторые люди][06] считают что Gulp гораздо лучше Grunt, и обещают Gulp
множество последователей. Я же считаю, что это [возмутительно и вопиюще нелепо][07].
Возможно, это и не так очевидно, но у Grunt есть множество плюсов по отношению
к Gulp. С другой стороны, у Gulp тоже есть преимущества по отношению к Grunt.

В этой статье я собираюсь **объяснить что из себя представляет Gulp**, так
как это достаточно новый инструмент, который появился около полугода назад.
Затем, _я хочу сравнить его с Grunt_, чтобы показать, что какой из инструментов 
делает лучше другого и почему.

[![gulp.png][08]][01]

[01]: http://gulpjs.com/ "Gulp Streaming Build System" 
[02]: https://github.com/gulpjs/gulp/ "gulpjs/gulp on GitHub"
[03]: https://github.com/gruntjs/grunt "gruntjs/grunt on GitHub"
[04]: /search/tagged/grunt "Posts tagged 'grunt' on Pony Foo"
[05]: http://bevacqua.io/buildfirst "JavaScript Application Design: A Build First Approach"
[06]: http://www.100percentjs.com/just-like-grunt-gulp-browserify-now/ "And just like that Grunt and RequireJS are out, itâ€™s all about Gulp and Browserify now"
[07]: http://www.youtube.com/watch?v=kRhW_zMlf0Y "Jackie Chiles on Seinfeld"
[08]: http://i.imgur.com/yFeBvMO.png "gulp.png"

# Введение в [Gulp][1]

Возможно, вам захочется пропустить эту часть если вы уже [читали README][2].
Кроме этого, я бы еще порекомендовал вам посмотреть исходный код Gulp — там мало
сюрпризов, скорее это просто хорошо продуманный и краткий код.

Как вы могли заметить в документации, установка Gulp очень похожа на установку
Grunt.

- Создать `package.json`
- `npm install -g gulp`
- `npm install --save-dev gulp`
- Создать `gulpfile.js`
- `gulp`

В этом месте главное различие с Grunt заключается в том, что Gulp не выносит
свой **CLI** из основного модуля _(по крайней мере пока)_. Это может немного
запутать вас, если вы не понимаете, как [устанавливаются глобальные модули][3]
в `npm`.

Перед тем, как мы перейдем к простому gulpfile.js, давайте разберемся, что 
представляет собой API Gulp. API содержит 5 методов. В общем-то, это все, что
вам понадобиться. Это потрясающий лаконичный API, который действительно помогает
Gulp фокусироваться на главном — решении задач связанных со сборкой проектов.

- `.src(globs[, options])` принимает [glob][4] и возвращает входной поток
- `.dest(path)` принимает путь к файлу, и возвращает исходящий поток
- `.task(name[, deps], fn)` определяет задачу
- `.run(tasks...[, cb])` запускает задачу
- `.watch(glob [, opts], cb)` следит за изменениями в файловой системе

Вы можете сказать, что этот API просто великолепен! Посмотрим на простую задачу из
документации Gulp — компилирование Jade-шаблонов. Здесь `jade()` и `minify()` —
плагины Gulp — мы вернемся к этому заявлению через минуту. 

    js gulp.src('./client/templates/*.jade')
      .pipe(jade()) .pipe(minify())
      .pipe(gulp.dest('./build/minified_templates'));

Здесь не так уж и много шаблонного кода, потому что мы здесь просто пишем код, 
а не собираем объект-конфигурацию.

В Grunt вам, напротив, понадобиться немного шаблонного кода для того, чтобы
сделать то же самое: загрузка `npm` модулей с помощью
`grunt.loadNpmTasks`, создание ссылки на задачу, которая содержит список требуемых тасков, и
конфигурация каждой задачи так, как нам нужно. Одна из проблем Grunt, которую
решает Gulp — это единый монолитный конфигурационный объект, заставляющий вас
прыгать через обручи, чтобы достичь желаемых результатов.

Если в процессе сборки вам приходится минифицировать код и копировать несколько
независимых друг от друга файлов, то таск `copy` будет содержать две абсолютно
несвязанных друг с другом операции копирования, хотя они и будут иметь различные
цели.

Gulp отлично, показывает как код вместо конфигурации может помочь предотвратить
ситуацию, в которой конфигурация начинает сбивать с толку.

## Каков `gulp` на вкус

Взгляните на этот короткий пример `gulpfile.js`, адаптированный из документации.

    var gulp = require('gulp'); 
    var uglify = require('gulp-uglify'); 

    gulp.task('scripts', function() { 
      // Minify and copy all JavaScript (except vendor scripts) 
      gulp.src(['client/js/**/*.js', '!client/js/vendor/**']) 
        .pipe(uglify()) 
        .pipe(gulp.dest('build/js'));

        // Copy vendor files 
        gulp.src('client/js/vendor/**') 
          .pipe(gulp.dest('build/js/vendor')); 

    }); 

    // The default task (called when you run `gulp`) 
    gulp.task('default', function() { 
      gulp.run('scripts'); 

      // Watch files and run tasks if they change 
      gulp.watch('client/js/**', function(event) { 
        gulp.run('scripts'); 
      }); 
    });

Согласитесь, это выглядит чертовски читаемо, даже если вы не знакомы с потоковой
системой передачи данных в NodeJS? Я уверен, что это гораздо читаемее, чем
`Gruntfile.js`, который делал бы те же самые вещи, потому здесь мы можем просто
пробежаться глазами по коду и понять, что здесь происходит. Это гораздо легче,
чем в случае с GruntJS. А если вы избавитесь от очевидных комментариев, то вы
получите очень лаконичный `gulpfile.js`.

Тот факт, что Gulp обеспечивает реализацию метода `.watch` как часть своего
основного API также радует, потому как наблюдение за изменениями файлов является
ключевой частью функциональности систем сборки, необходимой в процессе
разработки. Поддержка [разработки асинхронных задач][5] кажется гораздо лучше
интеграрованной в Gulp чем в Grunt, где цели(targets) действительно усложняют
работу при передаче данных в задачи.

В целом, API, который есть у Gulp обеспечивает более понятное и простое
использование, чем Grunt. Это более-менее аргумент для Gulp — **простой,
лаконичный, потрясающий** API. И простые плагины, которые выполняют единственную
простую задачу, а не делают все, что им может понадобиться, как это принято
в большинстве плагинов Grunt. Но у Gulp тоже есть недостатки.
(Not everything is pink roses for Gulp, though, and there are a few downsides to it as well.)

## Я выбираю `/Gr?u(nt|lp)/`

Давайте посмотрим, где сравнение между этими таск-менеджерами заходит в тупик.
В Gulp все основано на потоковой системе передачи данных, как если бы вы писали
shell-скрипты. Все в порядке, если вы понимаете, как устроены [потоки в NodeJS][6],
но если это не так — похоже, что для вас настали плохие времена.

[![streams.jpg][7]][8]

Если вы близки к NodeJS, то вам будет трудно игнорировать ту смелость, с которой
Gulp строит механизм сборки вокруг кода, вместо конфигурации, как это делает
Grunt. Однако, с другой стороны, это неоспоримый недостаток — некоторые люди
просто не понимают потоки NodeJS. Это могут быть PHP-разработчики, или какие-то
другие сервеные вуду, типа Ruby или Python. Они могут не знать ничего о потоках
и буферах в NodeJS. Может быть они и знают CommonJS, но едва ли они продвинулись
в нем дальше своей зоны комфорта. Такие люди никогда откажутся от Grunt в пользу
Gulp.

> В то время, как Gulp легче для чтения, Grunt легче для написания, и порой
> это гораздо важнее.


Gulp ориентирован на сборку. В особенности, _на работу с файлами_. На этом,
собственно, и основан API Gulp: «In, Out, Watch». Это здорово, потому что
это позволяет сконцентрироваться на задачах. На сборке. В этом и есть идея — вы
передаете что-то на вход: а затем что-то возвращаете, используя некоторые
преобразования, которые придают форму результату. Но в этом есть минус, потому
что, с таким API, вещи, которые не относятся к процессу сборки, становятся
сложнее. К примеру, [отправка уведомления об окончании сборки][9] или запуск 
[Amazon EC2-серверов][10] противоречат тому, для чего был разработан Gulp.

Gulp очень молод, и мы можем видеть, как развивается его эко-система, но я
не жду, что разработка задач будет под эту систему более популярна, чем
под Grunt. Я думаю, что это хорошо, я не верю что Gulp сможет стать лучше, чем
Grunt в непрерывной интеграции и в области развертки приложений, тогда как Gulp
может полностью возьмять на себя более простые воркфлоу которые не заходят
дальше сборки клиетской части или публикации на Heroku.

## Gulp не победит Grunt

Вот несколько причин, почему я верю, что Gulp вытеснит Grunt. Хотя он может
привлечь больше внимания к нему, расширяя границы того, что сейчас могут сделать
системы сборки проектов на JavaScript. Во-первых, Gulp не собирается побеждать
Grunt. По крайней мере, ни у кого нет такой цели. И этой цели точно нет
у лидеров индустрии.

<blockquote class="twitter-tweet" lang="en">
  <p>Grunt vs. Gulp: both serve different needs &amp; can coexist happily. 
     See: <a href="http://t.co/fQ5G8HDNwl">http://t.co/fQ5G8HDNwl</a> &amp;&amp; <a href="https://t.co/joUVeRqj8T">https://t.co/joUVeRqj8T</a>. 
     We&#39;ll support both
  </p>
  &mdash; Addy Osmani (@addyosmani) <a href="https://twitter.com/addyosmani/statuses/420870024379637760">January 8, 2014</a>
</blockquote> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



Возможно, для вас это как новость, но вряд ли должно быть сюрпризом. В текущую
эко-систему Grunt было вложено много усилий, и едва ли кто-то все бросит, просто
для того, чтобы портировать свои плагины под Gulp — новую горячую цыпочку
в городке. Вы можете сделать свой выбор — придерживаться того, что есть у вас,
или пуститься в погоню за популярной и таинственной блондиночкой.

Во-вторых, как я уже написал раньше, в Gulp есть определенный порог входа,
которого нет у Grunt. Без опыта в nodejs у вас будут трудности со потоками, 
передачей данных между ними, с буферами, и с ассинхронным JavaScript в целом
(с промисами, коллбеками, да с чем угодно!), и, учитывая все эти факторы, я
просто не представляю как gulp может просочиться в среду далеких от NodeJS людей
и применяться там как система для сборки фронт-енда.

Кроме того, Gulp **не решает каждой новой проблемы**. Серьезно. API великолепен
и целенаправлен, но он вызывает затруднения в задачах не касающихся сборки —
в этом побеждает Grunt. В `npm` зарегистрировано [больше 2000 плагинов Grunt][11],
а для Gulp написано всего [около 200][12]. Интересно видеть как Gulp может
запускать задачи Grunt, но я сомневаюсь, что это приживется. 

Я не думаю, что `/Gr?u(nt|lp)/` сделает вашу жизнь легче. Вряд ли. Если вам кажется, 
что вам нужны обе системы сборки, то _вероятно, вам стоит остановиться на Grunt_.

![regex.png][13] 

Здесь также рассматривался фактор скорости работы. Я предлагаю вам обдумать это
самостоятельно. Важнее всего понять, что здесь нет единственно правильного
ответа. Gulp может быть быстрее, возможности Grunt могут быть более обширными,
но в конце концов, вы предпочтете один другому. Не используйте оба в одном
приложении, не будьте как этот парень.

<blockquote class="twitter-tweet" lang="en">
  <p>just switched a project from <a href="https://twitter.com/search?q=%23gruntjs&amp;src=hash">#gruntjs</a> to <a href="https://twitter.com/search?q=%23gulpjs&amp;src=hash">#gulpjs</a> - simpler code, &amp; build time on save during watch from 3-5sec to 10-20ms. I kid you not.</p>
  &mdash; Andy Joslin (@andytjoslin) <a href="https://twitter.com/andytjoslin/statuses/416424985662468097">December 27, 2013</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

Стоит иметь в виду еще один фактор — за все эти дни Grunt не подал никакого вида.
Это заставляет волноваться.

## Grunt стареет

Grunt _может потухнуть сам по себе_. Он целую вечность находился в версии `0.4.1`,
перед тем как сдвинуться к скромной `0.4.2`, а сейчас, кажется, что он вообще
никуда не двигается. За все эти дни, практически не было активности в твиттере
[@gruntjs][14]. Вряд ли это хороший знак.

Я действительно надеюсь что это переходный период и под капотом планируется
`0.5.0`, но я чувствую, будто команда переключилась на другой проект. Я бы не стал
говорить, что Grunt заброшен, но у меня есть такие опасения, потому что я не вижу,
никаких признаков активной работы над ним. Мне очень сильно хочется увидеть релиз
`1.0.0` с переосмысленной структурой конфигурации, с учетом тех проблем о которых
мы говорили выше. Хочется увидеть простую загрузку плагинов, встроенный в ядро
watch, подобно тому, как это сделал Gulp, простую семантическую структуру
файлов, и более легкую настройку задач в целом.

Конечно, _хотеть_ такие штуки просто, но вот реализовать их не сломав большинство
из 2000 работающих плагинов тяжело. Учитывая, что эко-система плагинов в Grunt
является одной из главных ценностей — получить правильный план развития
становится черезвычайно сложно, и это разумно. И это важно. Мы можем только
сидеть и ждать, либо вы можете попробовать [пойти вперед и предложить что-нубудь][17],
что бы вы хотели видеть в `0.5.0`.

## Не плоди сущностей

Правые Unix-экстремисты [снова][18] и [снова][18] предлагают перестать плодить
сущности — забыть о Gulp и Grunt. Просто забыть. Я, по правде говоря, не согласен
с таким типом экстремизма, но вам может быть более комфортно, если вы напишете
все на чистом JavaScript. Я даже думаю, что в этом может быть определенный смысл.
In the case of Gulp, I do consider the `npm run` approach as a valid questioning of its purpose. (Тут, похоже междусобойчик про task.js. Но я его не понял).

Gulp достаточно близко находится философии отказа от создания лишних сущностей, 
но в каких-то моментах он все-таки ближе к Grunt, который далек от таких идей.
Я думаю, Gulp придает значение обеспечению поддержки Windows, но это приносит
определенную сложность, так что это действительно компромисс. Вам нужно спросить
себя, что вы ищете. И, если вам нужно что-то очень и очень простое, то вам
действительно лучше использовать `npm run`! 

Поддержка windows, врядли имеет много смысла, потому что большинство из нас
работают на _*nix_, но это важно для других сообществ, куда Grunt [похоже
постепенно приходит][20]. Думаю, вы можете использовать кое-что от `bash`
в Windows, но делать там что-то в командной строке — все еще боль. Да и вообще,
вряд ли это серьезный аргумент, чтобы _не использовать_ Grunt на Windows.

[![nothing.png][15]][16] 

Что ж, используйте Gulp или Grunt. Любой из них.

## Любой, _но_

Grunt выигрывает в простоте обучения людей сборке, да и то, его вряд ли легко
[понять любому][21], но он проигрывает в лаконичности. Gulp выигрывает
в краткости и имеет великолепный API, но проигрывает во входном уровне,
в первую очередь потому что потоки достаточно трудно понять. В углу малых усилий
и рисков находится `npm run`. Он хорош тем, что не плодит лишних сущностей,
и там вообще нет ничего лишего. Но он проигрывает в кросс-платформенности,
если это для вас важно.

Выбирайте сами. Не стоит принимать решение, основываясь на _чьих-то словах_.
Выбирайте инструмент, который работает для вас. Тот, который вы понимаете,
и с которым вам нравится работать. А важнее всего, тот, **который делает именно то,
что вам нужно**. Не делайте выбор вслепую, выбирая наугад, или потому, что кто-то
вам что-то рассказал об этом инструменте. Также как и не стоит застревать,
используя монолитные jQuery приложения _(это просто аналогия)_, пробуйте что-то еще!
Будьте открыты к инновациям.

> **Be the change you want to see in the world.** 

А сейчас мне надо напиться.

[1]: http://gulpjs.com/ "Gulp Streaming Build System" 
[2]: https://github.com/gulpjs/gulp/ "gulpjs/gulp on GitHub" 
[3]: http://blog.nodejs.org/2011/03/23/npm-1-0-global-vs-local-installation/ "npm 1.0: Global vs Local installation" 
[4]: https://github.com/isaacs/node-glob "isaacs/node-glob on GitHub" 
[5]: https://github.com/gulpjs/gulp#async-task-support "Asynchronous Task Support in Gulp" 
[6]: http://www.youtube.com/watch?v=lQAV3bPOYHo "Harnessing the awesome power of streams" 
[7]: http://i.imgur.com/pnEIqGO.jpg 
[8]: http://www.youtube.com/watch?v=lQAV3bPOYHo "Harnessing the awesome power of streams" 
[9]: https://npmjs.org/package/grunt-winston "grunt-winston can log data over different transports" 
[10]: https://github.com/bevacqua/grunt-ec2 "grunt-ec2 creates, deploys to, and shuts down Amazon EC2 instances" 
[11]: http://gruntjs.com/plugins "Grunt Plugin Listing" 
[12]: http://gratimax.github.io/search-gulp-plugins/ "Search for Gulp Plugins" 
[13]: http://i.imgur.com/Ih0Y1Zw.png "To generate #1 albums, 'jay --help' recommends the -z flag." 
[14]: https://twitter.com/gruntjs "@gruntjs on Twitter" 
[15]: http://img.youtube.com/vi/EQnaRtNMGMI/0.jpg 
[16]: http://www.youtube.com/watch?v=EQnaRtNMGMI "The Nothing Pitch" 
[17]: https://github.com/gruntjs/grunt/issues?milestone=7 "Grunt issues for the 0.5.0 milestone" 
[18]: http://substack.net/task_automation_with_npm_run "task automation with npm run" 
[19]: https://gist.github.com/substack/8313379 "introducing ./task.js, THE new javascript task runner automation framework" 
[20]: https://npmjs.org/search?q=grunt-php "although I've no factual information to support that claim" 
[21]: http://24ways.org/2013/grunt-is-not-weird-and-hard/ "Grunt for People Who Think Things Like Grunt are Weird and Hard""
